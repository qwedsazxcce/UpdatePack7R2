name: ä¸‹è½½ä¸Šä¼ Win7å·¥å…·åˆ°Miscï¼ˆä¿®å¤æ–‡ä»¶ä¸ºç©ºç‰ˆï¼‰
on: [workflow_dispatch]
jobs:
  download-upload:
    runs-on: windows-latest
    timeout-minutes: 180
    steps:
      - name: æ£€å‡ºä»“åº“
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      # å‰ç½®æ­¥éª¤ï¼šéªŒè¯curlå¯ç”¨æ€§å¹¶è¾“å‡ºè·¯å¾„
      - name: æ£€æŸ¥curlç¯å¢ƒ
        shell: cmd
        run: |
          @echo off
          echo === æ£€æŸ¥curlç‰ˆæœ¬å’Œè·¯å¾„ ===
          C:\Windows\System32\curl.exe --version
          echo === curlè·¯å¾„ ===
          where curl.exe
          echo === ç½‘ç»œæµ‹è¯• ===
          C:\Windows\System32\curl.exe -L https://github.com -I

      # æ–‡ä»¶1ï¼šUpdatePack7R2-26.1.15.exeï¼ˆæ ¸å¿ƒä¿®å¤ï¼‰
      - name: ä¸‹è½½æ–‡ä»¶1
        shell: cmd
        run: |
          @echo off
          setlocal enabledelayedexpansion
          set "fn=UpdatePack7R2-26.1.15.exe"
          set "url=https://github.com/yuanpeirong/UpdatePack7R2/releases/download/UpdatePack7R2/UpdatePack7R2-26.1.15.exe"
          echo === å¼€å§‹ä¸‹è½½æ–‡ä»¶1ï¼š%fn% ===
          :: ä½¿ç”¨curlå…¨è·¯å¾„ï¼Œå¢åŠ è¯¦ç»†æ—¥å¿—ã€å¼ºåˆ¶å¤±è´¥è¿”å›ã€å¼ºé€‚é…User-Agent
          C:\Windows\System32\curl.exe -v -L -f -o "%fn%" ^
            -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36" ^
            --retry 15 ^
            --retry-delay 20 ^
            --max-time 7200 ^
            --retry-all-errors ^
            "%url%"
          
          :: ä¼˜åŒ–æ–‡ä»¶æ ¡éªŒé€»è¾‘
          if not exist "%fn%" (
            echo âŒ æ–‡ä»¶1ä¸å­˜åœ¨ï¼
            exit 1
          )
          :: è·å–æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
          for %%f in ("%fn%") do set "filesize=%%~zf"
          echo æ–‡ä»¶1å¤§å°ï¼š!filesize! å­—èŠ‚
          if !filesize! lss 1024 (
            echo âŒ æ–‡ä»¶1ä¸ºç©ºæˆ–è¿‡å°ï¼ˆå°äº1KBï¼‰ï¼
            exit 1
          )
          echo âœ… æ–‡ä»¶1ä¸‹è½½æˆåŠŸ
          echo FILE1=%fn% >> %GITHUB_ENV%

      - name: ä¸Šä¼ æ–‡ä»¶1
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Misc
          overwrite: true
          files: ${{ env.FILE1 }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # æ–‡ä»¶2ï¼šdotNetFx48_20251014_x64.WA
      - name: ä¸‹è½½æ–‡ä»¶2
        shell: cmd
        run: |
          @echo off
          setlocal enabledelayedexpansion
          set "fn=dotNetFx48_20251014_x64.WA"
          set "url=https://github.com/abbodi1406/dotNetFx4xW7A/releases/download/25.10.14/dotNetFx48_20251014_x64.WA"
          echo === å¼€å§‹ä¸‹è½½æ–‡ä»¶2ï¼š%fn% ===
          C:\Windows\System32\curl.exe -v -L -f -o "%fn%" ^
            -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36" ^
            --retry 15 ^
            --retry-delay 20 ^
            --max-time 7200 ^
            --retry-all-errors ^
            "%url%"
          
          if not exist "%fn%" (echo âŒ æ–‡ä»¶2ä¸å­˜åœ¨ï¼& exit 1)
          for %%f in ("%fn%") do set "filesize=%%~zf"
          echo æ–‡ä»¶2å¤§å°ï¼š!filesize! å­—èŠ‚
          if !filesize! lss 1024 (echo âŒ æ–‡ä»¶2ä¸ºç©ºæˆ–è¿‡å°ï¼& exit 1)
          echo âœ… æ–‡ä»¶2ä¸‹è½½æˆåŠŸ
          echo FILE2=%fn% >> %GITHUB_ENV%

      - name: ä¸Šä¼ æ–‡ä»¶2
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Misc
          overwrite: true
          files: ${{ env.FILE2 }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # æ–‡ä»¶3ï¼šdotNetFx48_20250909_x86.WA
      - name: ä¸‹è½½æ–‡ä»¶3
        shell: cmd
        run: |
          @echo off
          setlocal enabledelayedexpansion
          set "fn=dotNetFx48_20250909_x86.WA"
          set "url=https://github.com/abbodi1406/dotNetFx4xW7A/releases/download/25.09.09/dotNetFx48_20250909_x86.WA"
          echo === å¼€å§‹ä¸‹è½½æ–‡ä»¶3ï¼š%fn% ===
          C:\Windows\System32\curl.exe -v -L -f -o "%fn%" ^
            -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36" ^
            --retry 15 ^
            --retry-delay 20 ^
            --max-time 7200 ^
            --retry-all-errors ^
            "%url%"
          
          if not exist "%fn%" (echo âŒ æ–‡ä»¶3ä¸å­˜åœ¨ï¼& exit 1)
          for %%f in ("%fn%") do set "filesize=%%~zf"
          echo æ–‡ä»¶3å¤§å°ï¼š!filesize! å­—èŠ‚
          if !filesize! lss 1024 (echo âŒ æ–‡ä»¶3ä¸ºç©ºæˆ–è¿‡å°ï¼& exit 1)
          echo âœ… æ–‡ä»¶3ä¸‹è½½æˆåŠŸ
          echo FILE3=%fn% >> %GITHUB_ENV%

      - name: ä¸Šä¼ æ–‡ä»¶3
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Misc
          overwrite: true
          files: ${{ env.FILE3 }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # æ–‡ä»¶4ï¼švcredist_x64_Win7_20250708.WA
      - name: ä¸‹è½½æ–‡ä»¶4
        shell: cmd
        run: |
          @echo off
          setlocal enabledelayedexpansion
          set "fn=vcredist_x64_Win7_20250708.WA"
          set "url=https://gitlab.com/-/project/11037551/uploads/8899c68cf5b5bfc7da7f04b73afa9f58/vcredist_x64_Win7_20250708.WA"
          echo === å¼€å§‹ä¸‹è½½æ–‡ä»¶4ï¼š%fn% ===
          C:\Windows\System32\curl.exe -v -L -f -o "%fn%" ^
            -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36" ^
            --retry 15 ^
            --retry-delay 20 ^
            --max-time 7200 ^
            --retry-all-errors ^
            "%url%"
          
          if not exist "%fn%" (echo âŒ æ–‡ä»¶4ä¸å­˜åœ¨ï¼& exit 1)
          for %%f in ("%fn%") do set "filesize=%%~zf"
          echo æ–‡ä»¶4å¤§å°ï¼š!filesize! å­—èŠ‚
          if !filesize! lss 1024 (echo âŒ æ–‡ä»¶4ä¸ºç©ºæˆ–è¿‡å°ï¼& exit 1)
          echo âœ… æ–‡ä»¶4ä¸‹è½½æˆåŠŸ
          echo FILE4=%fn% >> %GITHUB_ENV%

      - name: ä¸Šä¼ æ–‡ä»¶4
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Misc
          overwrite: true
          files: ${{ env.FILE4 }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # æ–‡ä»¶5ï¼švcredist_x86_Win7_20250708_r.WA
      - name: ä¸‹è½½æ–‡ä»¶5
        shell: cmd
        run: |
          @echo off
          setlocal enabledelayedexpansion
          set "fn=vcredist_x86_Win7_20250708_r.WA"
          set "url=https://gitlab.com/-/project/11037551/uploads/49d56348397669befad302f58070ab2f/vcredist_x86_Win7_20250708_r.WA"
          echo === å¼€å§‹ä¸‹è½½æ–‡ä»¶5ï¼š%fn% ===
          C:\Windows\System32\curl.exe -v -L -f -o "%fn%" ^
            -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36" ^
            --retry 15 ^
            --retry-delay 20 ^
            --max-time 7200 ^
            --retry-all-errors ^
            "%url%"
          
          if not exist "%fn%" (echo âŒ æ–‡ä»¶5ä¸å­˜åœ¨ï¼& exit 1)
          for %%f in ("%fn%") do set "filesize=%%~zf"
          echo æ–‡ä»¶5å¤§å°ï¼š!filesize! å­—èŠ‚
          if !filesize! lss 1024 (echo âŒ æ–‡ä»¶5ä¸ºç©ºæˆ–è¿‡å°ï¼& exit 1)
          echo âœ… æ–‡ä»¶5ä¸‹è½½æˆåŠŸ
          echo FILE5=%fn% >> %GITHUB_ENV%

      - name: ä¸Šä¼ æ–‡ä»¶5
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Misc
          overwrite: true
          files: ${{ env.FILE5 }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # æ–‡ä»¶6ï¼švcredist_x64_2022_WinAll_14.44.35211.WA
      - name: ä¸‹è½½æ–‡ä»¶6
        shell: cmd
        run: |
          @echo off
          setlocal enabledelayedexpansion
          set "fn=vcredist_x64_2022_WinAll_14.44.35211.WA"
          set "url=https://gitlab.com/-/project/11037551/uploads/ce26d073600eb68db902bc12946d42e7/vcredist_x64_2022_WinAll_14.44.35211.WA"
          echo === å¼€å§‹ä¸‹è½½æ–‡ä»¶6ï¼š%fn% ===
          C:\Windows\System32\curl.exe -v -L -f -o "%fn%" ^
            -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36" ^
            --retry 15 ^
            --retry-delay 20 ^
            --max-time 7200 ^
            --retry-all-errors ^
            "%url%"
          
          if not exist "%fn%" (echo âŒ æ–‡ä»¶6ä¸å­˜åœ¨ï¼& exit 1)
          for %%f in ("%fn%") do set "filesize=%%~zf"
          echo æ–‡ä»¶6å¤§å°ï¼š!filesize! å­—èŠ‚
          if !filesize! lss 1024 (echo âŒ æ–‡ä»¶6ä¸ºç©ºæˆ–è¿‡å°ï¼& exit 1)
          echo âœ… æ–‡ä»¶6ä¸‹è½½æˆåŠŸ
          echo FILE6=%fn% >> %GITHUB_ENV%

      - name: ä¸Šä¼ æ–‡ä»¶6
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Misc
          overwrite: true
          files: ${{ env.FILE6 }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # æ–‡ä»¶7ï¼švcredist_x86_2022_WinAll_14.44.35211_r.WA
      - name: ä¸‹è½½æ–‡ä»¶7
        shell: cmd
        run: |
          @echo off
          setlocal enabledelayedexpansion
          set "fn=vcredist_x86_2022_WinAll_14.44.35211_r.WA"
          set "url=https://gitlab.com/-/project/11037551/uploads/16a7925f42634ef7232d7d9cc122034a/vcredist_x86_2022_WinAll_14.44.35211_r.WA"
          echo === å¼€å§‹ä¸‹è½½æ–‡ä»¶7ï¼š%fn% ===
          C:\Windows\System32\curl.exe -v -L -f -o "%fn%" ^
            -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36" ^
            --retry 15 ^
            --retry-delay 20 ^
            --max-time 7200 ^
            --retry-all-errors ^
            "%url%"
          
          if not exist "%fn%" (echo âŒ æ–‡ä»¶7ä¸å­˜åœ¨ï¼& exit 1)
          for %%f in ("%fn%") do set "filesize=%%~zf"
          echo æ–‡ä»¶7å¤§å°ï¼š!filesize! å­—èŠ‚
          if !filesize! lss 1024 (echo âŒ æ–‡ä»¶7ä¸ºç©ºæˆ–è¿‡å°ï¼& exit 1)
          echo âœ… æ–‡ä»¶7ä¸‹è½½æˆåŠŸ
          echo FILE7=%fn% >> %GITHUB_ENV%

      - name: ä¸Šä¼ æ–‡ä»¶7
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Misc
          overwrite: true
          files: ${{ env.FILE7 }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: å®Œæˆæç¤º
        shell: cmd
        run: echo ğŸ‰ æ‰€æœ‰æ–‡ä»¶å·²æˆåŠŸä¸‹è½½å¹¶ä¸Šä¼ åˆ°Misc Releasesï¼
