name: é€ä¸ªä¸‹è½½ä¸Šä¼ Win7å·¥å…·åˆ°Misc Releasesï¼ˆä¿®æ­£å‚æ•°ç‰ˆï¼‰

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘

jobs:
  download-upload-one-by-one:
    runs-on: windows-latest
    timeout-minutes: 180
    steps:
      # æ­¥éª¤1ï¼šæ£€å‡ºä»“åº“
      - name: æ£€å‡ºä»£ç ä»“åº“
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      # ===================== é€ä¸ªå¤„ç†æ–‡ä»¶ =====================
      # ç¬¬1ä¸ªæ–‡ä»¶ï¼šUpdatePack7R2-26.1.15.exe
      - name: ä¸‹è½½æ–‡ä»¶1 - UpdatePack7R2-26.1.15.exe
        shell: pwsh
        id: download_1
        run: |
          $filename = "UpdatePack7R2-26.1.15.exe"
          $url = "https://github.com/yuanpeirong/UpdatePack7R2/releases/download/UpdatePack7R2/UpdatePack7R2-26.1.15.exe"
          
          Write-Host "=== å¼€å§‹ä¸‹è½½æ–‡ä»¶1ï¼š$filename ==="
          Invoke-WebRequest -Uri $url -OutFile $filename `
            -UserAgent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" `
            -MaximumRetryCount 10 `
            -RetryIntervalSec 15 `
            -TimeoutSec 3600

          if (Test-Path $filename -PathType Leaf) {
            $size = (Get-Item $filename).Length / 1MB
            Write-Host "âœ… æ–‡ä»¶1ä¸‹è½½æˆåŠŸï¼Œå¤§å°ï¼š$($size.ToString('0.00')) MB"
            echo "FILE1_NAME=$filename" >> $env:GITHUB_ENV
          } else {
            Write-Error "âŒ æ–‡ä»¶1ä¸‹è½½å¤±è´¥ï¼"
            exit 1
          }

      - name: ä¸Šä¼ æ–‡ä»¶1åˆ°Misc Releases
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Misc
          overwrite: true
          files: ${{ env.FILE1_NAME }}
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_RELEASE_UPLOAD_CONCURRENCY: 1

      # ç¬¬2ä¸ªæ–‡ä»¶ï¼šdotNetFx48_20251014_x64.WA
      - name: ä¸‹è½½æ–‡ä»¶2 - dotNetFx48_20251014_x64.WA
        shell: pwsh
        id: download_2
        run: |
          $filename = "dotNetFx48_20251014_x64.WA"
          $url = "https://github.com/abbodi1406/dotNetFx4xW7A/releases/download/25.10.14/dotNetFx48_20251014_x64.WA"
          
          Write-Host "=== å¼€å§‹ä¸‹è½½æ–‡ä»¶2ï¼š$filename ==="
          Invoke-WebRequest -Uri $url -OutFile $filename `
            -UserAgent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" `
            -MaximumRetryCount 10 `
            -RetryIntervalSec 15 `
            -TimeoutSec 3600

          if (Test-Path $filename -PathType Leaf) {
            $size = (Get-Item $filename).Length / 1MB
            Write-Host "âœ… æ–‡ä»¶2ä¸‹è½½æˆåŠŸï¼Œå¤§å°ï¼š$($size.ToString('0.00')) MB"
            echo "FILE2_NAME=$filename" >> $env:GITHUB_ENV
          } else {
            Write-Error "âŒ æ–‡ä»¶2ä¸‹è½½å¤±è´¥ï¼"
            exit 1
          }

      - name: ä¸Šä¼ æ–‡ä»¶2åˆ°Misc Releases
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Misc
          overwrite: true
          files: ${{ env.FILE2_NAME }}
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_RELEASE_UPLOAD_CONCURRENCY: 1

      # ç¬¬3ä¸ªæ–‡ä»¶ï¼šdotNetFx48_20250909_x86.WA
      - name: ä¸‹è½½æ–‡ä»¶3 - dotNetFx48_20250909_x86.WA
        shell: pwsh
        id: download_3
        run: |
          $filename = "dotNetFx48_20250909_x86.WA"
          $url = "https://github.com/abbodi1406/dotNetFx4xW7A/releases/download/25.09.09/dotNetFx48_20250909_x86.WA"
          
          Write-Host "=== å¼€å§‹ä¸‹è½½æ–‡ä»¶3ï¼š$filename ==="
          Invoke-WebRequest -Uri $url -OutFile $filename `
            -UserAgent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" `
            -MaximumRetryCount 10 `
            -RetryIntervalSec 15 `
            -TimeoutSec 3600

          if (Test-Path $filename -PathType Leaf) {
            $size = (Get-Item $filename).Length / 1MB
            Write-Host "âœ… æ–‡ä»¶3ä¸‹è½½æˆåŠŸï¼Œå¤§å°ï¼š$($size.ToString('0.00')) MB"
            echo "FILE3_NAME=$filename" >> $env:GITHUB_ENV
          } else {
            Write-Error "âŒ æ–‡ä»¶3ä¸‹è½½å¤±è´¥ï¼"
            exit 1
          }

      - name: ä¸Šä¼ æ–‡ä»¶3åˆ°Misc Releases
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Misc
          overwrite: true
          files: ${{ env.FILE3_NAME }}
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_RELEASE_UPLOAD_CONCURRENCY: 1

      # ç¬¬4ä¸ªæ–‡ä»¶ï¼švcredist_x64_Win7_20250708.WAï¼ˆä¿®æ­£å‚æ•°ï¼‰
      - name: ä¸‹è½½æ–‡ä»¶4 - vcredist_x64_Win7_20250708.WA
        shell: pwsh
        id: download_4
        run: |
          $filename = "vcredist_x64_Win7_20250708.WA"
          $url = "https://gitlab.com/-/project/11037551/uploads/8899c68cf5b5bfc7da7f04b73afa9f58/vcredist_x64_Win7_20250708.WA"
          
          Write-Host "=== å¼€å§‹ä¸‹è½½æ–‡ä»¶4ï¼š$filename ==="
          # æ ¸å¿ƒä¿®æ­£ï¼š-AllowRedirection â†’ -AllowRedirect
          Invoke-WebRequest -Uri $url -OutFile $filename `
            -UserAgent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" `
            -MaximumRetryCount 10 `
            -RetryIntervalSec 15 `
            -TimeoutSec 3600 `
            -AllowRedirect  # æ­£ç¡®å‚æ•°

          if (Test-Path $filename -PathType Leaf) {
            $size = (Get-Item $filename).Length / 1MB
            Write-Host "âœ… æ–‡ä»¶4ä¸‹è½½æˆåŠŸï¼Œå¤§å°ï¼š$($size.ToString('0.00')) MB"
            echo "FILE4_NAME=$filename" >> $env:GITHUB_ENV
          } else {
            Write-Error "âŒ æ–‡ä»¶4ä¸‹è½½å¤±è´¥ï¼"
            exit 1
          }

      - name: ä¸Šä¼ æ–‡ä»¶4åˆ°Misc Releases
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Misc
          overwrite: true
          files: ${{ env.FILE4_NAME }}
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_RELEASE_UPLOAD_CONCURRENCY: 1

      # ç¬¬5ä¸ªæ–‡ä»¶ï¼švcredist_x86_Win7_20250708_r.WAï¼ˆä¿®æ­£å‚æ•°ï¼‰
      - name: ä¸‹è½½æ–‡ä»¶5 - vcredist_x86_Win7_20250708_r.WA
        shell: pwsh
        id: download_5
        run: |
          $filename = "vcredist_x86_Win7_20250708_r.WA"
          $url = "https://gitlab.com/-/project/11037551/uploads/49d56348397669befad302f58070ab2f/vcredist_x86_Win7_20250708_r.WA"
          
          Write-Host "=== å¼€å§‹ä¸‹è½½æ–‡ä»¶5ï¼š$filename ==="
          Invoke-WebRequest -Uri $url -OutFile $filename `
            -UserAgent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" `
            -MaximumRetryCount 10 `
            -RetryIntervalSec 15 `
            -TimeoutSec 3600 `
            -AllowRedirect  # æ­£ç¡®å‚æ•°

          if (Test-Path $filename -PathType Leaf) {
            $size = (Get-Item $filename).Length / 1MB
            Write-Host "âœ… æ–‡ä»¶5ä¸‹è½½æˆåŠŸï¼Œå¤§å°ï¼š$($size.ToString('0.00')) MB"
            echo "FILE5_NAME=$filename" >> $env:GITHUB_ENV
          } else {
            Write-Error "âŒ æ–‡ä»¶5ä¸‹è½½å¤±è´¥ï¼"
            exit 1
          }

      - name: ä¸Šä¼ æ–‡ä»¶5åˆ°Misc Releases
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Misc
          overwrite: true
          files: ${{ env.FILE5_NAME }}
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_RELEASE_UPLOAD_CONCURRENCY: 1

      # ç¬¬6ä¸ªæ–‡ä»¶ï¼švcredist_x64_2022_WinAll_14.44.35211.WAï¼ˆä¿®æ­£å‚æ•°ï¼‰
      - name: ä¸‹è½½æ–‡ä»¶6 - vcredist_x64_2022_WinAll_14.44.35211.WA
        shell: pwsh
        id: download_6
        run: |
          $filename = "vcredist_x64_2022_WinAll_14.44.35211.WA"
          $url = "https://gitlab.com/-/project/11037551/uploads/ce26d073600eb68db902bc12946d42e7/vcredist_x64_2022_WinAll_14.44.35211.WA"
          
          Write-Host "=== å¼€å§‹ä¸‹è½½æ–‡ä»¶6ï¼š$filename ==="
          Invoke-WebRequest -Uri $url -OutFile $filename `
            -UserAgent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" `
            -MaximumRetryCount 10 `
            -RetryIntervalSec 15 `
            -TimeoutSec 3600 `
            -AllowRedirect  # æ­£ç¡®å‚æ•°

          if (Test-Path $filename -PathType Leaf) {
            $size = (Get-Item $filename).Length / 1MB
            Write-Host "âœ… æ–‡ä»¶6ä¸‹è½½æˆåŠŸï¼Œå¤§å°ï¼š$($size.ToString('0.00')) MB"
            echo "FILE6_NAME=$filename" >> $env:GITHUB_ENV
          } else {
            Write-Error "âŒ æ–‡ä»¶6ä¸‹è½½å¤±è´¥ï¼"
            exit 1
          }

      - name: ä¸Šä¼ æ–‡ä»¶6åˆ°Misc Releases
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Misc
          overwrite: true
          files: ${{ env.FILE6_NAME }}
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_RELEASE_UPLOAD_CONCURRENCY: 1

      # ç¬¬7ä¸ªæ–‡ä»¶ï¼švcredist_x86_2022_WinAll_14.44.35211_r.WAï¼ˆä¿®æ­£å‚æ•°ï¼‰
      - name: ä¸‹è½½æ–‡ä»¶7 - vcredist_x86_2022_WinAll_14.44.35211_r.WA
        shell: pwsh
        id: download_7
        run: |
          $filename = "vcredist_x86_2022_WinAll_14.44.35211_r.WA"
          $url = "https://gitlab.com/-/project/11037551/uploads/16a7925f42634ef7232d7d9cc122034a/vcredist_x86_2022_WinAll_14.44.35211_r.WA"
          
          Write-Host "=== å¼€å§‹ä¸‹è½½æ–‡ä»¶7ï¼š$filename ==="
          Invoke-WebRequest -Uri $url -OutFile $filename `
            -UserAgent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" `
            -MaximumRetryCount 10 `
            -RetryIntervalSec 15 `
            -TimeoutSec 3600 `
            -AllowRedirect  # æ­£ç¡®å‚æ•°

          if (Test-Path $filename -PathType Leaf) {
            $size = (Get-Item $filename).Length / 1MB
            Write-Host "âœ… æ–‡ä»¶7ä¸‹è½½æˆåŠŸï¼Œå¤§å°ï¼š$($size.ToString('0.00')) MB"
            echo "FILE7_NAME=$filename" >> $env:GITHUB_ENV
          } else {
            Write-Error "âŒ æ–‡ä»¶7ä¸‹è½½å¤±è´¥ï¼"
            exit 1
          }

      - name: ä¸Šä¼ æ–‡ä»¶7åˆ°Misc Releases
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Misc
          overwrite: true
          files: ${{ env.FILE7_NAME }}
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_RELEASE_UPLOAD_CONCURRENCY: 1

      # æ­¥éª¤2ï¼šå…¨æµç¨‹å®Œæˆç¡®è®¤
      - name: æ‰€æœ‰æ–‡ä»¶å¤„ç†å®Œæˆ
        shell: pwsh
        run: |
          Write-Host "ğŸ‰ æ‰€æœ‰7ä¸ªæ–‡ä»¶å·²å®Œæˆã€Œä¸‹è½½â†’ä¸Šä¼ ã€å…¨æµç¨‹ï¼"
          Write-Host "=== æœ€ç»ˆæ–‡ä»¶åˆ—è¡¨ ==="
          Get-ChildItem *.exe, *.WA | Format-Table Name, Length
