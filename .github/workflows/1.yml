name: Download & Publish Server 2008 R2 ISO

# 手动触发工作流
on:
  workflow_dispatch:

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # 授予发布Releases的权限

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install 7-Zip
        run: sudo apt-get update && sudo apt-get install -y p7zip-full

      - name: Download ISO File
        run: |
          # 下载指定ISO，保持原文件名不变
          wget -O "cn_windows_server_2008_r2_with_sp1_vl_build_x64_dvd_617396.iso" \
          "https://archive.isdn.network/windows/cn_windows_server_2008_r2_with_sp1_vl_build_x64_dvd_617396.iso"

      - name: 7-Zip 分卷压缩 (1950M/卷)
        run: |
          # 分卷压缩参数：-v1950M 指定单卷大小，保持原文件名，压缩包后缀为.7z
          7z a -v1950M "cn_windows_server_2008_r2_with_sp1_vl_build_x64_dvd_617396.iso.7z" \
          "cn_windows_server_2008_r2_with_sp1_vl_build_x64_dvd_617396.iso"

      - name: Publish to Releases
        uses: softprops/action-gh-release@v2
        with:
          # 设置Release标签和名称，匹配项目名
          tag_name: WindowsServer_2008R2
          name: WindowsServer_2008R2
          # 上传所有分卷压缩包（.7z.001/.002...）
          files: cn_windows_server_2008_r2_with_sp1_vl_build_x64_dvd_617396.iso.7z.*
          # 可选：设置为预发布版本
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
